

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/head.png">
  <link rel="icon" href="/img/head.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Epiphany">
  <meta name="keywords" content="">
  
    <meta name="description" content="é¦–å‘äºå¥‡å®‰ä¿¡  æºç åˆ†æå…³æ³¨ä¸¤ä¸ªæ–¹é¢ï¼Œç¬¬ä¸€ä¸ªæ–¹é¢å…³æ³¨afl-gccçš„æ’æ¡©æ–¹å¼ï¼Œç¬¬äºŒä¸ªæ–¹é¢å…³æ³¨afl-fuzzæ¨¡å¼ï¼Œå’Œå˜å¼‚æ¨¡å¼ã€‚ ä¸ºäº†æ–¹ä¾¿ä¸‹é¢çš„åˆ†æï¼Œéœ€è¦å…ˆäº†è§£ä¸€ç‚¹çŸ¥è¯†ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹AFLçš„makefile afl-gcc: afl-gcc.c $(COMM_HDR) | test_x86 	$(CC) $(CFLAGS) $@.c -o $@ $(LDFLAGS) 	set -e; for i i">
<meta property="og:type" content="article">
<meta property="og:title" content="AFL(äºŒ)---ç¼–è¯‘å’Œæ’æ¡©åˆ†æ">
<meta property="og:url" content="http://example.com/2022/12/15/AFL-%E4%BA%8C-%E7%BC%96%E8%AF%91%E5%92%8C%E6%8F%92%E6%A1%A9%E5%88%86%E6%9E%90/index.html">
<meta property="og:site_name" content="Epiphany&#39;s blog">
<meta property="og:description" content="é¦–å‘äºå¥‡å®‰ä¿¡  æºç åˆ†æå…³æ³¨ä¸¤ä¸ªæ–¹é¢ï¼Œç¬¬ä¸€ä¸ªæ–¹é¢å…³æ³¨afl-gccçš„æ’æ¡©æ–¹å¼ï¼Œç¬¬äºŒä¸ªæ–¹é¢å…³æ³¨afl-fuzzæ¨¡å¼ï¼Œå’Œå˜å¼‚æ¨¡å¼ã€‚ ä¸ºäº†æ–¹ä¾¿ä¸‹é¢çš„åˆ†æï¼Œéœ€è¦å…ˆäº†è§£ä¸€ç‚¹çŸ¥è¯†ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹AFLçš„makefile afl-gcc: afl-gcc.c $(COMM_HDR) | test_x86 	$(CC) $(CFLAGS) $@.c -o $@ $(LDFLAGS) 	set -e; for i i">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fortypra.oss-cn-hangzhou.aliyuncs.com/img/20221215151315.png">
<meta property="article:published_time" content="2022-12-15T07:21:02.000Z">
<meta property="article:modified_time" content="2022-12-19T08:44:46.831Z">
<meta property="article:author" content="Epiphany">
<meta property="article:tag" content="AFL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://fortypra.oss-cn-hangzhou.aliyuncs.com/img/20221215151315.png">
  
  
  
  <title>AFL(äºŒ)---ç¼–è¯‘å’Œæ’æ¡©åˆ†æ - Epiphany&#39;s blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/prism/1.27.0/plugins/line-numbers/prism-line-numbers.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="/css/test.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.2","typing":{"enable":true,"typeSpeed":70,"cursorChar":"ğŸ˜Š","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"syTAHbVDGa0ZSug10p7Z9QM4-gzGzoHsz","app_key":"BDZY8j2r1l97VE3uLcsrU2Vd","server_url":"https://sytahbvd.lc-cn-n1-shared.com","path":"window.location.pathname","ignore_local":true}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  

  

  

  

  

  

  

  
    
  



  
<meta name="generator" content="Hexo 6.2.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Epiphany&#39;s blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CTF">
                    
                    CTF
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/CVE">
                    
                    CVE
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/others">
                    
                    others
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/categories/chats">
                    
                    chats
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://fortypra.oss-cn-hangzhou.aliyuncs.com/img/20221215151315.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="AFL(äºŒ)---ç¼–è¯‘å’Œæ’æ¡©åˆ†æ"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-12-15 15:21" pubdate>
          æ˜ŸæœŸå››, åäºŒæœˆ 15æ—¥ 2022, 3:21 ä¸‹åˆ
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          <!-- compatible with older versions-->
          16k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          <!-- compatible with older versions-->
          130 åˆ†é’Ÿ
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> æ¬¡
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">AFL(äºŒ)---ç¼–è¯‘å’Œæ’æ¡©åˆ†æ</h1>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>é¦–å‘äºå¥‡å®‰ä¿¡</p>
</blockquote>
<p>æºç åˆ†æå…³æ³¨ä¸¤ä¸ªæ–¹é¢ï¼Œç¬¬ä¸€ä¸ªæ–¹é¢å…³æ³¨afl-gccçš„æ’æ¡©æ–¹å¼ï¼Œç¬¬äºŒä¸ªæ–¹é¢å…³æ³¨afl-fuzzæ¨¡å¼ï¼Œå’Œå˜å¼‚æ¨¡å¼ã€‚</p>
<p>ä¸ºäº†æ–¹ä¾¿ä¸‹é¢çš„åˆ†æï¼Œéœ€è¦å…ˆäº†è§£ä¸€ç‚¹çŸ¥è¯†ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹AFLçš„makefile</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">afl<span class="token operator">-</span>gcc<span class="token operator">:</span> afl<span class="token operator">-</span>gcc<span class="token punctuation">.</span>c $<span class="token punctuation">(</span>COMM_HDR<span class="token punctuation">)</span> <span class="token operator">|</span> test_x86
	$<span class="token punctuation">(</span>CC<span class="token punctuation">)</span> $<span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> $@<span class="token punctuation">.</span>c <span class="token operator">-</span>o $@ $<span class="token punctuation">(</span>LDFLAGS<span class="token punctuation">)</span>
	set <span class="token operator">-</span>e<span class="token punctuation">;</span> <span class="token keyword">for</span> i in afl<span class="token operator">-</span>g<span class="token operator">++</span> afl<span class="token operator">-</span>clang afl<span class="token operator">-</span>clang<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token keyword">do</span> ln <span class="token operator">-</span>sf afl<span class="token operator">-</span>gcc $$i<span class="token punctuation">;</span> done

afl<span class="token operator">-</span>as<span class="token operator">:</span> afl<span class="token operator">-</span>as<span class="token punctuation">.</span>c afl<span class="token operator">-</span>as<span class="token punctuation">.</span>h $<span class="token punctuation">(</span>COMM_HDR<span class="token punctuation">)</span> <span class="token operator">|</span> test_x86
	$<span class="token punctuation">(</span>CC<span class="token punctuation">)</span> $<span class="token punctuation">(</span>CFLAGS<span class="token punctuation">)</span> $@<span class="token punctuation">.</span>c <span class="token operator">-</span>o $@ $<span class="token punctuation">(</span>LDFLAGS<span class="token punctuation">)</span>
	ln <span class="token operator">-</span>sf afl<span class="token operator">-</span>as as<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>å¯ä»¥çŸ¥é“afl-g++ç­‰éƒ½æ˜¯æŒ‡å‘afl-gccçš„ï¼Œä¸”éƒ½æ˜¯ç”±afl-gcc.cç¼–è¯‘å‡ºæ¥çš„ã€‚</p>
<p>æ­¤å¤–afl-fuzzæœ‰ä¸‰ç§æ¨¡å¼</p>
<ul>
<li>æ™®é€šæ¨¡å¼ æ±‡ç¼–å±‚é¢æ’æ¡©ï¼Œä¸€èˆ¬ç”¨gccå’Œclang</li>
<li>llvmæ¨¡å¼ï¼Œç¼–è¯‘å±‚é¢ä¸ºç¨‹åºæ’æ¡©ï¼Œé€‚ç”¨äºclangï¼Œä¸€èˆ¬ä½¿ç”¨afl-clang-fastç¼–è¯‘</li>
<li>qemuæ¨¡å¼ï¼Œé€šè¿‡ä¿®æ”¹qemuçš„ä»£ç ï¼Œåœ¨æ¨¡æ‹Ÿç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œè®°å½•ç¨‹åºè·¯å¾„èµ·åˆ°ç±»ä¼¼äºæ’æ¡©çš„æ•ˆæœã€‚<br>
è¿™æ¬¡åˆ†æafl-fuzz.cåªæ¶‰åŠåˆ°ç¬¬ä¸€ä¸ªæ¨¡å¼llvmæ¨¡å¼å’Œqemuçš„æºç åç»­å†çœ‹</li>
</ul>
<h1>afl-gcc</h1>
<p>é€‰æ‹©å…ˆçœ‹gccçš„æºç ï¼Œå› ä¸ºå°±300+å¾ˆå¥½çœ‹ï¼Œæ ¸å¿ƒå‡½æ•°åªæœ‰ä¸‰ä¸ª<code>find_as</code>ï¼Œ<code>edit_params</code>ï¼Œ<code>main</code>ï¼Œå‰é¢çš„å­¦ä¹ ä¸­å¯ä»¥çŸ¥é“afl-gccæœ¬è´¨ä¸Šå°±æ˜¯åœ¨ç³»ç»Ÿçš„gccç¼–è¯‘å™¨çš„ä¸Šå±‚æ·»åŠ äº†ä¸€ä¸ªwrapperï¼Œå…·ä½“åˆ†æå¦‚ä¸‹ï¼š</p>
<h2 id="find-aså‡½æ•°"><a class="header-anchor" href="#find-aså‡½æ•°">Â¶</a>find_aså‡½æ•°</h2>
<p>å‡½æ•°åŸå‹<code>static void find_as(u8* argv0)</code>ï¼Œè¿™ä¸ªå‡½æ•°ä½¿ç”¨æ¥å¯»æ‰¾<code>afl-as</code>çš„ä½ç½®ï¼Œä¸‹é¢çœ‹ä»£ç ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">find_as</span><span class="token punctuation">(</span>u8<span class="token operator">*</span> argv0<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

  u8 <span class="token operator">*</span>afl_path <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string">"AFL_PATH"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  u8 <span class="token operator">*</span>slash<span class="token punctuation">,</span> <span class="token operator">*</span>tmp<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>afl_path<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    tmp <span class="token operator">=</span> <span class="token function">alloc_printf</span><span class="token punctuation">(</span><span class="token string">"%s/as"</span><span class="token punctuation">,</span> afl_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">access</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> X_OK<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//å¦‚æœå­˜åœ¨è¯¥æ–‡ä»¶</span>
      as_path <span class="token operator">=</span> afl_path<span class="token punctuation">;</span>
      <span class="token function">ck_free</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">ck_free</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  slash <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span>argv0<span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨/</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>slash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    u8 <span class="token operator">*</span>dir<span class="token punctuation">;</span>
    <span class="token operator">*</span>slash <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    dir <span class="token operator">=</span> <span class="token function">ck_strdup</span><span class="token punctuation">(</span>argv0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å»é™¤ç©ºæ ¼</span>
    <span class="token operator">*</span>slash <span class="token operator">=</span> <span class="token char">'/'</span><span class="token punctuation">;</span>
    tmp <span class="token operator">=</span> <span class="token function">alloc_printf</span><span class="token punctuation">(</span><span class="token string">"%s/afl-as"</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">access</span><span class="token punctuation">(</span>tmp<span class="token punctuation">,</span> X_OK<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      as_path <span class="token operator">=</span> dir<span class="token punctuation">;</span>
      <span class="token function">ck_free</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">ck_free</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ck_free</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">access</span><span class="token punctuation">(</span>AFL_PATH <span class="token string">"/as"</span><span class="token punctuation">,</span> X_OK<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    as_path <span class="token operator">=</span> AFL_PATH<span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">FATAL</span><span class="token punctuation">(</span><span class="token string">"Unable to find AFL wrapper binary for 'as'. Please set AFL_PATH"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<ul>
<li>é¦–å…ˆæŸ¥æ‰¾<code>AFL_PATH</code>ç¯å¢ƒå˜é‡ï¼Œå¦‚æœå­˜åœ¨è¯¥ç¯å¢ƒå˜é‡åˆ™èµ‹å€¼ç»™afl-pathï¼Œç„¶åæŸ¥æ‰¾<code>afl_path/as</code>æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¯ä»¥è®¿é—®æŠŠafl-pathèµ‹å€¼ç»™as_pathã€‚</li>
<li>å¦‚æœä¸å­˜åœ¨ç¯å¢ƒAFL_PATHï¼Œåˆ™æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‚æ•°çš„æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯ä¸æ˜¯/ï¼Œå¦‚æœæ˜¯åˆ™å»æ‰è¿™ä¸ªå­—ç¬¦ï¼ŒæŠŠèº«ä¸‹çš„ä½œä¸ºdirï¼Œä¾‹å¦‚<code>/home/tamako/afl-gcc</code>åé¢æ˜¯å¦å­˜åœ¨/ï¼Œæ£€æŸ¥å®Œæ¯•ä¹‹åï¼Œæ£€æµ‹<code>dir/afl-as</code>æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¯ä»¥è®¿é—®ï¼Œåˆ™è®¾ç½®ä¸ºas_path</li>
<li>ä»¥ä¸Šéƒ½ä¸è¡Œï¼Œåˆ™FATALæŠ›å‡ºé”™è¯¯</li>
</ul>
<p>é€šè¿‡ç¯å¢ƒå˜é‡å’Œå‚æ•°æ¥æŸ¥æ‰¾<code>as</code>çš„ä½ç½®ï¼Œç¯å¢ƒå˜é‡çš„ä¼˜å…ˆçº§é«˜äºå‚æ•°ï¼Œæ‰¾åˆ°<code>as</code>ä½ç½®ä¹‹åï¼Œå°†å€¼ä¼ é€’ç»™<code>as_path</code>ã€‚</p>
<h2 id="edit-params"><a class="header-anchor" href="#edit-params">Â¶</a>edit_params</h2>
<p>å¯¹äºè¯¥å‡½æ•°ï¼Œæœ‰ä¸€æ¡æ³¨é‡Š</p>
<blockquote>
<p>Copy argv to cc_params, making the necessary edits</p>
</blockquote>
<p>çœ‹æ³¨é‡Šå¯ä»¥çŸ¥é“ï¼Œè¯¥å‡½æ•°æ˜¯æŠŠå‚æ•°å¤åˆ¶åˆ°cc_paramsï¼Œç„¶ååšä¸€äº›å¿…è¦çš„ç¼–è¾‘ã€‚<br>
å‡½æ•°æ¯”è¾ƒé•¿ï¼Œå°±ä¸è´´äº†ï¼Œä¸‹é¢è¯´ä¸€ä¸‹è¯¥å‡½æ•°çš„ä¸»è¦æµç¨‹ã€‚</p>
<ul>
<li>é¦–å…ˆck_allocå‡½æ•°ç”³è¯·äº†ä¸€å¤§ç‰‡ç©ºé—´ç»™cc_params</li>
<li>æ¥ä¸‹æ¥æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå‚æ•°çš„æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœä¸æ˜¯ / é‚£ä¹ˆå°†å‚æ•°ä¸€èµ‹å€¼ç»™nameï¼Œå¦‚æœæ˜¯ / é‚£ä¹ˆå°† / åé¢çš„ä¸œè¥¿ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶åå­—ï¼‰èµ‹å€¼ç»™name</li>
<li>å°†nameçš„å‰9ä¸ªå­—ç¬¦å’Œ<code>afl-clang</code>è¿›è¡Œæ¯”è¾ƒ
<ul>
<li>å¦‚æœnameæ˜¯afl-clangï¼Œé‚£ä¹ˆè®¾ç½®<code>clang_mode=1</code>ç„¶åè®¾ç½®<code>CLANG_ENV_VAR</code>ç¯å¢ƒå˜é‡ä¸º1ï¼Œç„¶åæ¯”è¾ƒnameå’Œ<code>afl-clang++</code>
<ul>
<li>æ¥ä¸‹æ¥åˆæ˜¯ä¸€ä¸ªifåˆ¤æ–­ï¼Œè¯¥åˆ¤æ–­ä¸­è®¾ç½®äº†cc_params[0]ï¼Œé€šè¿‡å‰é¢çš„æ¯”è¾ƒï¼Œå¯ä»¥å¾—å‡ºç¼–è¯‘éœ€è¦çš„æ˜¯gccè¿˜æ˜¯g++</li>
<li>ç„¶åè·å¾—ç¯å¢ƒå˜é‡ä¸­çš„<code>AFL_GXXæˆ–è€…AFL_CC</code>ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆå°±èµ‹å€¼ä¸ºclangæˆ–è€…clang++</li>
</ul>
</li>
<li>å¦‚æœåå­—ä¸æ˜¯<code>afl-clang</code>ï¼Œé‚£ä¹ˆå°±å’Œafl-gccä»¥åŠafl-g++ï¼Œgcjæ¯”è¾ƒã€‚</li>
</ul>
</li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">--</span>argc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    u8<span class="token operator">*</span> cur <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">++</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strncmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-B"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>be_quiet<span class="token punctuation">)</span> <span class="token function">WARNF</span><span class="token punctuation">(</span><span class="token string">"-B is already set, overriding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cur<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> argc <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> argc<span class="token operator">--</span><span class="token punctuation">;</span> argv<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
      <span class="token keyword">continue</span><span class="token punctuation">;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-integrated-as"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-pipe"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__FreeBSD__<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">defined</span><span class="token punctuation">(</span>__x86_64__<span class="token punctuation">)</span></span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-m32"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> m32_set <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-fsanitize=address"</span><span class="token punctuation">)</span> <span class="token operator">||</span>
        <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"-fsanitize=memory"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> asan_set <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> <span class="token string">"FORTIFY_SOURCE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> fortify_set <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    cc_params<span class="token punctuation">[</span>cc_par_cnt<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> cur<span class="token punctuation">;</span>

  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>å¤„ç†å®Œç¼–è¯‘å™¨ä¹‹åï¼Œç»§ç»­å¤„ç†å‚æ•°ï¼Œå‚æ•°å¤§éƒ¨åˆ†éƒ½æ˜¯continueï¼Œåé¢å°‘æ•°å‡ ä¸ªé€‰é¡¹ï¼Œè®¾ç½®äº†å‡ ä¸ªæ ‡å¿—ä½ã€‚</p>
<ul>
<li>å¦‚æœå­˜åœ¨<code>-fsanitize=address</code>æˆ–è€…<code>-fsanitize=memory</code>ï¼Œå°±è®¾ç½®asan_setä¸º1;</li>
<li>å¦‚æœå­˜åœ¨<code>FORTIFY_SOURCE</code>ï¼Œåˆ™è®¾ç½®fortify_setä¸º1</li>
<li><code>cc_params[cc_par_cnt++] = cur</code>; å…¶ä¸­çš„cc_par_cntåº”è¯¥æ˜¯ä½œä¸ºindexå‡ºç°</li>
<li>åé¢ä¾æ—§æ˜¯è®¾ç½®å‚æ•°
<ul>
<li>é¦–å…ˆæ˜¯è®¾ç½®-Bå’Œå‰é¢åœ¨find_asä¸­è®¡ç®—å‡ºæ¥çš„as_pathï¼Œ<code>-B as_path</code></li>
<li>å¦‚æœè®¾ç½®äº†clang_mode é‚£ä¹ˆæ·»åŠ  <code>-no-integrated-as</code> å‚æ•°ã€‚</li>
<li>æ¥ä¸‹æ¥æ£€æŸ¥<code>AFL_HARDEN</code>ï¼Œå¦‚æœè®¾ç½®äº†è¯¥ç¯å¢ƒå˜é‡åˆ™æ·»åŠ <code>-fstack-protector-all</code>ï¼ˆæˆ‘ä¹Ÿä¸çŸ¥é“å¼€è¿™ä¸ªä¿æŠ¤æœ‰ä»€ä¹ˆç”¨ï¼‰
<ul>
<li>åŒæ—¶æ£€æŸ¥<code>fortify_set</code>ï¼Œè®¾ç½®<code>-D_FORTIFY_SOURCE=2</code>å‚æ•°ã€‚<br>
sanitizer</li>
</ul>
</li>
</ul>
</li>
<li>æ£€æŸ¥asanæ˜¯å¦è¢«è®¾ç½®ä¸º1ï¼Œå¦‚æœä¸º1ï¼Œåˆ™è®¾ç½®AFL_USE_ASANä¸º1</li>
<li>asanä¸ä¸º1ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡AFL_USE_ASANï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è®¾ç½®åç»­å‚æ•°ä¸º<code>-U_FORTIFY_SOURCE -fsanitize=address</code></li>
<li>AFL_USE_MSANå¦‚æœè¢«è®¾ç½®ï¼Œåˆ™å‚æ•°ä¸º<code>-U_FORTIFY_SOURCE -fsanitize=memory</code><br>
ä½†æ˜¯MASNå’ŒASANä¸èƒ½è¢«åŒæ—¶ä½¿ç”¨ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>æ£€æŸ¥**<font color="#ff0000">AFL_DONT_OPTIMIZE</font>**ç¯å¢ƒå˜é‡æœ‰æ²¡æœ‰è¢«è®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰è¢«è®¾ç½®ï¼Œåˆ™æ·»åŠ å‚æ•°<code>-g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1</code>(x86å’Œfreebsdä¸‹é¢ï¼Œå¦‚æœå¼€äº†clang modeå’Œm32åˆ™æ²¡æœ‰-gå‚æ•°)</li>
<li>è‹¥è®¾ç½®äº†**<font color="#ff0000">AFL_NO_BUILTIN</font>**ç¯å¢ƒå˜é‡ï¼Œåˆ™æ·»åŠ <code>-fno-builtin-strcmp</code>ç­‰å‚æ•°</li>
<li>æœ€åæ‰§è¡Œ<code>cc_params[cc_par_cnt] = NULL;</code>ï¼Œä½œä¸ºå‚æ•°çš„æˆªæ­¢ç¬¦</li>
</ul>
<p>è¯¥å‡½æ•°ä¸»è¦æ˜¯æ·»åŠ äº†ä¸€ä¸ª-Bå‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†åŠ«æŒçš„asçš„è·¯å¾„ï¼Œå³ä¸ä½¿ç”¨åŸæœ¬çš„asæ±‡ç¼–ï¼Œè€Œä½¿ç”¨afl-asæ±‡ç¼–ï¼ŒåŒæ—¶ï¼Œè¯¥å‡½æ•°å¯¹ASANï¼Œclang modeç­‰è®¾ç½®äº†flagï¼Œä¸”å°†ç¯å¢ƒç¼–è¯‘çš„<code>GXX GCC</code>éƒ½åšäº†è®¾ç½®ã€‚</p>
<h2 id="mainå‡½æ•°"><a class="header-anchor" href="#mainå‡½æ•°">Â¶</a>mainå‡½æ•°</h2>
<p>mainå‡½æ•°æ€»ç»“èµ·æ¥å°±åªæœ‰ä¸‰è¡Œ</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">find_as</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">edit_params</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">execvp</span><span class="token punctuation">(</span>cc_params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>cc_params<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div></figure>
<p>ç»“åˆèµ·æ¥çœ‹ï¼Œé¦–å…ˆæ‰¾åˆ°<code>afl-as</code>çš„è·¯å¾„ï¼Œç„¶åé‡æ–°ç¼–è¾‘ä¸€äº›å‚æ•°ï¼Œæœ€åæ‰§è¡Œæ”¹å˜å‚æ•°ä¹‹åçš„ç¨‹åºï¼Œä»æ„ä¹‰ä¸Šçœ‹åªæ˜¯å¯¹asçš„è·¯å¾„è¿›è¡Œäº†åŠ«æŒå’Œä¿®æ”¹ï¼Œå¯ä»¥æ‰“å°ä¸€ä¸‹å…¶ä¸­çš„å‚æ•°ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">find_as</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> argc<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\targ%d: %s\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token function">edit_params</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">15</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\targ%d: %s\n"</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>cc_params<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">afl-cc <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span>
	arg0: /home/tamako/Desktop/FUZZ/AFL_debug/AFLcpp/afl-gcc
	arg1: -g
	arg2: -o
	arg3: fuzz1_png
	arg4: test.c

	arg0: gcc
	arg1: -g
	arg2: -o
	arg3: fuzz1_png
	arg4: test.c
	arg5: -B
	arg6: /home/tamako/Desktop/FUZZ/AFL_debug/AFLcpp
	arg7: -g
	arg8: -O3
	arg9: -funroll-loops
	arg10: -D__AFL_COMPILER<span class="token operator">=</span><span class="token number">1</span>
	arg11: -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION<span class="token operator">=</span><span class="token number">1</span>
	arg12: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
	arg13: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
	arg14: <span class="token punctuation">(</span>null<span class="token punctuation">)</span>
afl-as <span class="token number">2</span>.57b by <span class="token operator">&lt;</span>lcamtuf@google.com<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>å…³äºå…¶ä¸­ä¸€äº›ç»†èŠ‚çš„ç†è§£å¯ä»¥çœ‹ä¸‹é¢ï¼Œé¦–å…ˆæˆ‘ä»¬è§‚å¯Ÿä¸€ä¸‹gccçš„å…·ä½“æ“ä½œï¼Œè™½ç„¶æˆ‘ä»¬å¹³æ—¶å¯¹ç¼–è¯‘é“¾æ¥é‚£ä¸€å¥—æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œä½†æ˜¯ä½¿ç”¨<code>--verbose</code>å‚æ•°å¯ä»¥å¾—åˆ°gccç¼–è¯‘çš„è¯¦ç»†å…¨è¿‡ç¨‹ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gcc --verbose test.c -o <span class="token builtin class-name">test</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 /usr/lib/gcc/x86_64-linux-gnu/9/cc1 -quiet -v -imultiarch x86_64-linux-gnu test.c -quiet -dumpbase test.c -mtune<span class="token operator">=</span>generic -march<span class="token operator">=</span>x86-64 -auxbase <span class="token builtin class-name">test</span> -version -fasynchronous-unwind-tables -fstack-protector-strong -Wformat -Wformat-security -fstack-clash-protection -fcf-protection -o /tmp/cc7SDSlv.s
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 as -v --64 -o /tmp/cc1aWLRu.o /tmp/cc7SDSlv.s
GNU assembler version <span class="token number">2.34</span> <span class="token punctuation">(</span>x86_64-linux-gnu<span class="token punctuation">)</span> using BFD version <span class="token punctuation">(</span>GNU Binutils <span class="token keyword">for</span> Ubuntu<span class="token punctuation">)</span> <span class="token number">2.34</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
 /usr/lib/gcc/x86_64-linux-gnu/9/collect2 -plugin /usr/lib/gcc/x86_64-linux-gnu/9/liblto_plugin.so -plugin-opt<span class="token operator">=</span>/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper -plugin-opt<span class="token operator">=</span>-fresolution<span class="token operator">=</span>/tmp/ccx9lNVu.res -plugin-opt<span class="token operator">=</span>-pass-through<span class="token operator">=</span>-lgcc -plugin-opt<span class="token operator">=</span>-pass-through<span class="token operator">=</span>-lgcc_s -plugin-opt<span class="token operator">=</span>-pass-through<span class="token operator">=</span>-lc -plugin-opt<span class="token operator">=</span>-pass-through<span class="token operator">=</span>-lgcc -plugin-opt<span class="token operator">=</span>-pass-through<span class="token operator">=</span>-lgcc_s --build-id --eh-frame-hdr -m elf_x86_64 --hash-style<span class="token operator">=</span>gnu --as-needed -dynamic-linker /lib64/ld-linux-x86-64.so.2 -pie -z now -z relro -o <span class="token builtin class-name">test</span> /usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/x86_64-linux-gnu/Scrt1.o /usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/x86_64-linux-gnu/crti.o /usr/lib/gcc/x86_64-linux-gnu/9/crtbeginS.o -L/usr/lib/gcc/x86_64-linux-gnu/9 -L/usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/x86_64-linux-gnu -L/usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/lib -L/lib/x86_64-linux-gnu -L/lib/<span class="token punctuation">..</span>/lib -L/usr/lib/x86_64-linux-gnu -L/usr/lib/<span class="token punctuation">..</span>/lib -L/usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span> /tmp/cc1aWLRu.o -lgcc --push-state --as-needed -lgcc_s --pop-state -lc -lgcc --push-state --as-needed -lgcc_s --pop-state /usr/lib/gcc/x86_64-linux-gnu/9/crtendS.o /usr/lib/gcc/x86_64-linux-gnu/9/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/x86_64-linux-gnu/crtn.o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>ä»ä¸Šé¢ç®€å•èŠ‚é€‰å‡ºæ¥çš„å†…å®¹å¯ä»¥çœ‹åˆ°ï¼Œé¦–å…ˆè°ƒç”¨çš„æ˜¯cc1ç¼–è¯‘ç”Ÿæˆ<code>/tmp/cc7SDSlv.s</code>ï¼Œç„¶åä½¿ç”¨asè¿›è¡Œæ±‡ç¼–ï¼ŒæŠŠcc7SDSlv.sè½¬åŒ–ä¸º<code>/tmp/cc1aWLRu.o</code>ï¼Œæœ€åç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>åœ¨ä»¥ä¸Šçš„afl-gccçš„ä»£ç é‡Œé¢åªçœ‹åˆ°äº†wrapperéƒ¨åˆ†ï¼Œå®é™…ä¸Šçš„è°ƒç”¨å´æ²¡ä½“ç°å‡ºæ¥ï¼Œï¼ˆå…¶å®ä»”ç»†çœ‹å¯ä»¥çŸ¥é“å°±æ˜¯-Bä¸€ä¸ªå‚æ•°æŒ‡å®šäº†æ‰¾åˆ°çš„<code>afl-asè·¯å¾„</code>å®é™…ä¸Šä¹Ÿå¯ä»¥æ‰“å°ä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/home/tamako/Desktop/FUZZ/AFL_debug/AFLcpp/as -v --64 -o /tmp/ccn9gj4T.o /tmp/cc6rIr4V.s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure>
<p>å¯ä»¥å‘ç°æ±‡ç¼–çš„ä»£ç å˜æˆäº†å¦‚ä¸Šä»£ç ï¼Œæ‰€ä»¥afl-gccåœ¨ç¼–è¯‘çš„æ—¶å€™æ²¡é—®é¢˜ï¼Œæ¤å…¥çš„æ’æ¡©ä»£ç å®åœ¨æ±‡ç¼–çš„æ—¶å€™æ¤å…¥çš„ï¼Œä¸‹é¢åˆ†æä¸€ä¸‹afl-asæºç ã€‚</p>
<h1>afl-as</h1>
<h2 id="edit-paramså‡½æ•°"><a class="header-anchor" href="#edit-paramså‡½æ•°">Â¶</a>edit_paramså‡½æ•°</h2>
<p>å’Œafl-gccä¸­çš„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç¼–è¾‘ä¼ é€’ç»™<code>as</code>çš„å‚æ•°ã€‚å…¶ä¸­æ¶‰åŠåˆ°ä¸€äº›å¯¹MAC OSç³»ç»Ÿçš„å¤„ç†ï¼Œéƒ½å®šä¹‰åœ¨äº†<code>__APPLE</code>å®ä¸­ï¼Œåç»­çŸ­æ—¶é—´å†…ä¸ä¼šæ¶‰åŠåˆ°APPLEçš„ç³»ç»Ÿï¼Œæ‰€ä»¥åˆ†æçš„æ—¶å€™ç»•è¿‡è¯¥ç±»ï¼ŒæŠŠæ¡å¤§ä½“çš„æ’æ¡©å³å¯ã€‚</p>
<p>å¼€ç¯‡çš„æ³¨é‡Šä»‹ç»äº†å‡½æ•°çš„ä¸»è¦å†…å®¹</p>
<blockquote>
<p>/* Examine and modify parameters to pass to â€˜asâ€™. Note that the file nameÂ is always the last parameter passed by GCC, so we exploit this propertyÂ to keep the code simple. */</p>
</blockquote>
<p>ä¿®æ”¹asçš„å‚æ•°ï¼Œfile name ä¸€èˆ¬éƒ½æ˜¯gccä¼ é€’è¿‡æ¥çš„æœ€åä¸€ä¸ªå‚æ•°ï¼ŒæŠ“ä½è¿™ä¸ªè¦ç‚¹å¯ä»¥è®©ä»£ç å˜å¾—ç®€æ´ã€‚</p>
<ul>
<li>ä»ç¯å¢ƒå˜é‡ä¸­è·å¾—éœ€è¦æ±‡ç¼–çš„<code>.s</code>æ–‡ä»¶çš„ç›®å½•ï¼Œ<code>TMPDIR TMP TEMP</code>ç¯å¢ƒå˜é‡éƒ½æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œå°±è®¾ç½®è¯¥ç›®å½•ä¸º<code>/tmp</code>ï¼ˆé»˜è®¤ä¸ºtmpï¼‰</li>
<li>åŒæ ·çš„ï¼Œè·å¾—<code>AFL_AS</code>çš„å€¼ï¼ˆafl-asçš„è·¯å¾„ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åˆ™è®¾ç½®ä¸º<code>as</code></li>
<li>éå†æ‰€æœ‰çš„å‚æ•°ï¼Œæ ¹æ®-m64å’Œ-m32è®¾ç½®<code>use_64bit</code>ä¸º1æˆ–è€…0</li>
<li>å…¶ä½™çš„å‚æ•°ç®€å•çš„å¤åˆ¶åˆ°<code>as_params</code>å³å¯</li>
<li><code>input_file = argv[argc - 1];</code>æœ€åä¸€ä¸ªå‚æ•°èµ‹å€¼ç»™input_file
<ul>
<li>å¦‚æœæ˜¯â€“versionï¼Œé‚£ä¹ˆè®¾ç½®just_versionæ ‡å¿—ä½ï¼Œè®¾ç½®modified_fileä¸ºinput fileï¼Œç„¶åè·³åˆ°ç»“å°¾</li>
<li>å¦‚æœä¸æ˜¯â€“versionï¼Œé‚£ä¹ˆä¸€èˆ¬å°±æ˜¯ç›®æ ‡æ–‡ä»¶ï¼ˆå…·ä½“å¯ä»¥åœ¨ä¸Šæ–‡gccç»†èŠ‚ä¸­çœ‹åˆ°ï¼‰ï¼Œæ£€æŸ¥å®Œæ¯•å¯¹åº”ä¸´æ—¶æ–‡ä»¶å¤¹ï¼Œç„¶åè¿›è¡Œé‡å‘½å</li>
</ul>
</li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">modified_file <span class="token operator">=</span> <span class="token function">alloc_printf</span><span class="token punctuation">(</span><span class="token string">"%s/.afl-%u-%u.s"</span><span class="token punctuation">,</span> tmp_dir<span class="token punctuation">,</span> <span class="token function">getpid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>u32<span class="token punctuation">)</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></div></figure>
<p>è®¾ç½®æ–‡ä»¶åå­—ä¸º<code>tmp_dir/.afl-pid-time.s</code>è¿™æ ·çš„ç±»å‹<br>
ç»“å°¾</p>
<ul>
<li>è®¾ç½®<code>as_params[as_par_cnt++] = modified_file</code></li>
<li><code>as_params[as_par_cnt] = NULL;</code></li>
</ul>
<p>å¯¹åŸæ¥çš„å‚æ•°åšäº†ä¸€äº›ä¿®æ”¹çš„å·¥ä½œï¼Œæ‰¾åˆ°åŸæ¥ç”Ÿæˆçš„éœ€è¦è¢«æ±‡ç¼–çš„æ–‡ä»¶ï¼Œä¸€èˆ¬æ¥è¯´ç»è¿‡gccä¹‹åè¯¥æ–‡ä»¶ä¸º<code>/tmp/éšæœºæ•°.s</code>ï¼Œmodifyä¸€ä¸ªæ–°çš„æ–‡ä»¶<code>tmp_dir/.afl-pid-time.s</code>è¿™ä¸ªæ–‡ä»¶åœ¨åé¢çš„å‡½æ•°ä¸­è¢«ç”¨æ¥å­˜æ”¾æ’æ¡©åçš„ä»£ç ï¼Œé™¤æ­¤ä¹‹å¤–è¯¥å‡½æ•°è¿˜è®¾ç½®äº†ä¸€äº›æ ‡å¿—ä½ï¼Œå±äºä¸€äº›ç»†èŠ‚ï¼Œå±è”½å³å¯ã€‚</p>
<h2 id="add-instrumentationå‡½æ•°"><a class="header-anchor" href="#add-instrumentationå‡½æ•°">Â¶</a>add_instrumentationå‡½æ•°</h2>
<blockquote>
<p>/* Process input file, generate modified_file. Insert instrumentation in all Â the appropriate places. */</p>
</blockquote>
<p>å¤„ç†ç¨‹åºçš„è¾“å…¥æ–‡ä»¶ï¼Œç”Ÿæˆmodified_fileï¼Œåœ¨é€‚å½“çš„ä½ç½®æ’å…¥instrumentã€‚</p>
<p>ç”Ÿæˆçš„modified_fileå³ä¸ºæ’æ¡©åçš„æ–‡ä»¶ï¼Œinstrumentationå³ä¸ºæ’æ¡©ä»£ç ã€‚</p>
<ul>
<li>å¦‚æœinput_fileä¸ä¸ºç©ºï¼Œé‚£ä¹ˆæ‰“å¼€input_fileï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸º<code>inf</code>ï¼Œå¦‚æœä¸ºç©ºåˆ™è®¾ç½®ä¸ºstdinï¼Œinfä¸ºFILE* ç±»å‹æŒ‡é’ˆã€‚</li>
<li>ç„¶åæ‰“å¼€modified_fileå¯¹åº”çš„ä¸´æ—¶æ–‡ä»¶ï¼Œå¹¶è·å–å…¶å¥æŸ„outfdï¼Œå†æ ¹æ®å¥æŸ„é€šè¿‡fdopenå‡½æ•°æ‹¿åˆ°FILE* æŒ‡é’ˆoutf</li>
<li>æ¥ä¸‹æ¥é€šè¿‡whileå¾ªç¯å’Œgetlineå‡½æ•°ï¼ŒæŠŠinput_fileçš„å†…å®¹è½¬å­˜åˆ°lineå†…ï¼Œä¸€æ¬¡è¯»å‡º8192ã€‚<br>
<strong>æ¥ä¸‹æ¥å°±æ˜¯å‡½æ•°æœ€é‡è¦çš„éƒ¨åˆ†</strong>ï¼Œwhileå¾ªç¯å†…æ˜¯æ’æ¡©çš„ä¸€äº›é™åˆ¶æ¡ä»¶ï¼Œé€šè¿‡ä¸€äº›åˆ¤æ–­ï¼Œä»è€Œæ–­å®šåœ¨å“ªäº›åœ°æ–¹æ’æ¡©ï¼Œå“ªäº›åœ°æ–¹åº”è¯¥æ’æ¡©ã€‚</li>
</ul>
<h3 id="åº”è¯¥åœ¨å“ªé‡Œæ’æ¡©"><a class="header-anchor" href="#åº”è¯¥åœ¨å“ªé‡Œæ’æ¡©">Â¶</a>åº”è¯¥åœ¨å“ªé‡Œæ’æ¡©</h3>
<p>å¯ä»¥çœ‹åˆ°whileå¾ªç¯å†…çš„å‡ æ®µæ³¨é‡Š</p>
<blockquote>
<p>/* In some cases, we want to defer writing the instrumentation trampoline<br>
until after all the labels, macros, comments, etc. If weâ€™re in this<br>
mode, and if the line starts with a tab followed by a character, dump<br>
the trampoline now. */</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨ä¸€äº›æƒ…å†µä¸‹æ’æ¡©ï¼š<br>
æ­¤å¤–ï¼Œå¦‚æœå½“å‰è¿™ä¸€è¡Œç”±æŒ‡æ ‡ç¬¦<code>\t</code>å¼€å§‹å¹¶ä¸”åœ¨åˆ¶è¡¨ç¬¦åé¢ç´§ç´§è·Ÿç€ä¸€ä¸ªå­—æ¯ï¼Œåˆ™æ’å…¥trampolineï¼ˆtrampolineå³ç†è§£ä¸ºæ’æ¡©ï¼‰</p>
<p>åæ¥å†ç»§ç»­çœ‹ï¼Œä¸‹é¢æœ‰ä¸€æ®µåˆ«çš„æ³¨é‡Šå¼•èµ·äº†æˆ‘çš„æ³¨æ„</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-none"><code class="language-none">&#x2F;* If we&#39;re in the right mood for instrumenting, check for function 
   names or conditional labels. This is a bit messy, but in essence, 
   we want to catch:

     ^main:      - function entry point (always instrumented)
     ^.L0:       - GCC branch label
     ^.LBB0_0:   - clang branch label (but only in clang mode)
     ^\tjnz foo  - conditional branches

   ...but not:

     ^# BB#0:    - clang comments
     ^ # BB#0:   - ditto
     ^.Ltmp0:    - clang non-branch labels
     ^.LC0       - GCC non-branch labels
     ^.LBB0_0:   - ditto (when in GCC mode)
     ^\tjmp foo  - non-conditional jumps

   Additionally, clang and GCC on MacOS X follow a different convention
   with no leading dots on labels, hence the weird maze of #ifdefs
   later on.
    *&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>è¿™é‡Œæ›´åŠ æ˜ç¡®çš„æå‡ºäº†å“ªäº›â€œæ ‡ç­¾â€ï¼Œç¼–è¯‘ä¹‹åçš„branch labelå’Œæœ‰æ¡ä»¶è·³è½¬éƒ½è¦æ’æ¡©ï¼Œåé¢è¿˜æœ‰ä¸€äº›ä¸æ’æ¡©çš„æƒ…å†µã€‚</p>
<h3 id="ä¸€äº›å¤´æ–‡ä»¶ä¸­çš„ä»£ç "><a class="header-anchor" href="#ä¸€äº›å¤´æ–‡ä»¶ä¸­çš„ä»£ç ">Â¶</a>ä¸€äº›å¤´æ–‡ä»¶ä¸­çš„ä»£ç </h3>
<p>trampoline_fmt_64è¿™ä¸ªå­—ç¬¦ä¸²å’Œtrampoline_fmt_32éƒ½å­˜åœ¨äºafl-as.hä¸­ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">const</span> u8<span class="token operator">*</span> trampoline_fmt_64 <span class="token operator">=</span>

  <span class="token string">"\n"</span>
  <span class="token string">"/* --- AFL TRAMPOLINE (64-BIT) --- */\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">".align 4\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"leaq -(128+24)(%%rsp), %%rsp\n"</span>
  <span class="token string">"movq %%rdx,  0(%%rsp)\n"</span>
  <span class="token string">"movq %%rcx,  8(%%rsp)\n"</span>
  <span class="token string">"movq %%rax, 16(%%rsp)\n"</span>
  <span class="token string">"movq $0x%08x, %%rcx\n"</span>
  <span class="token string">"call __afl_maybe_log\n"</span>
  <span class="token string">"movq 16(%%rsp), %%rax\n"</span>
  <span class="token string">"movq  8(%%rsp), %%rcx\n"</span>
  <span class="token string">"movq  0(%%rsp), %%rdx\n"</span>
  <span class="token string">"leaq (128+24)(%%rsp), %%rsp\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"/* --- END --- */\n"</span>
  <span class="token string">"\n"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>32å’Œ64æ„æ€å·®ä¸å¤šï¼Œéƒ½æ˜¯ä¸€æ®µç±»ä¼¼çš„æ±‡ç¼–ä»£ç ï¼Œä»¥64ä¸ºä¾‹åˆ†æï¼ŒæŒ‰ç…§fprintfçš„æ ¼å¼ï¼Œåœ¨åé¢çš„Rå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¼šå°†éšæœºå€¼æ ¼å¼åŒ–è¾“å…¥åˆ°ä¸Šé¢çš„è¿™ä¸€æ®µå­—ç¬¦ä¸²ä¸­ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°ç›®æ ‡ä»£ç ï¼š<code>&quot;movq $0x%08x, %%rcx\n&quot;</code>ï¼Œå¯ä»¥ç¡®å®šæ˜¯è¢«ä¼ å…¥äº†<code>rcx</code>å¯„å­˜å™¨ï¼Œå†å›å¤´çœ‹è¿™æ®µæ±‡ç¼–æœ¬èº«ï¼Œæ„æ€æ˜¯ï¼Œä¿å­˜å„ä¸ªå¯„å­˜å™¨çš„å€¼ï¼Œç„¶åèµ‹äºˆ<code>rcx</code>ä¸€ä¸ªéšæœºæ•°ï¼Œæœ€åè°ƒç”¨<code>__afl_maybe_log</code>å‡½æ•°ï¼Œ<code>__afl_maybe_log</code>å‡½æ•°çš„å®ç°ä¹Ÿåœ¨åŒä¸€ä¸ªå¤´æ–‡ä»¶ä¸­ï¼Œå­˜åœ¨äºå˜é‡<code>main_payload_64</code>ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼šå…¶å®ç°å’Œfuzzçš„forkserveræœºåˆ¶æœ‰å…³ç³»ã€‚</p>
<h4 id="forkserver-ç›¸å…³"><a class="header-anchor" href="#forkserver-ç›¸å…³">Â¶</a>forkserver ç›¸å…³</h4>
<p>AFLæä¾›äº†ä¸¤ç§fuzzerä¸è¢«fuzzç¨‹åºé€šä¿¡çš„æ–¹å¼ï¼š</p>
<ul>
<li>execv<br>
åœ¨fuzzerä¸­ï¼Œæ¯æ¬¡fuzzéƒ½è°ƒç”¨execvæ¥è¿è¡Œç›®æ ‡ç¨‹åºè¿›è¡Œfuzzã€‚ç„¶åç­‰å¾…ç¨‹åºæ‰§è¡Œç»“æŸï¼Œè·å¾—å…¶æ‰§è¡Œè·¯å¾„å’Œé€€å‡ºçŠ¶æ€ã€‚</li>
</ul>
<p>ä½¿ç”¨è¿™ç§æ–¹æ³•æ•ˆç‡ä½ä¸‹ã€‚å¦‚æœç›®æ ‡ç¨‹åºæ˜¯åŠ¨æ€é“¾æ¥çš„ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¯æ¬¡execvæ‰§è¡Œç¨‹åºéƒ½ä¼šè¿›è¡Œå†…å­˜åˆ†é…ï¼ŒåŠ¨æ€åº“çš„é“¾æ¥ç­‰è¿‡ç¨‹ï¼Œæ— ç–‘æ˜¯éå¸¸è€—è´¹æ—¶é—´çš„ã€‚å› æ­¤AFLé»˜è®¤ä¸ä¼šä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œé™¤éä½¿ç”¨ç‰¹æ®Šé€‰é¡¹(AFL_NO_FORKSRV,dumb_mode1)ã€‚</p>
<ul>
<li>forkserver<br>
fuzzerå’Œforkserverä½¿ç”¨ä¸¤ä¸ªç®¡é“é€šä¿¡ï¼Œä¸€ä¸ª<code>æ§åˆ¶ç®¡é“</code>(forkserverè¯»ï¼Œfuzzerå†™)ï¼Œä¸€ä¸ª<code>æ•°æ®ç®¡é“</code>(fuzzerè¯»ï¼Œforkserverå†™)</li>
</ul>
<p>fuzzerä¼šåœ¨åˆå§‹é˜¶æ®µè°ƒç”¨ä¸€æ¬¡execve()ï¼Œè¿è¡Œä¸€æ¬¡ç›®æ ‡ç¨‹åºï¼Œè¿™ä¸ªè¿è¡Œçš„ç¨‹åºè¢«ç§°ä¸ºforkserverï¼Œforkserverä¼šè¿è¡Œåˆ°æ’å…¥çš„æ¡©å¤„ï¼ˆmainå‡½æ•°å¼€å§‹çš„æ—¶å€™æ˜¯ç¬¬ä¸€ä¸ªæ¡©ï¼‰ï¼Œç„¶åå°±ä¼šæ‰§è¡Œåˆ°afl_maybe_logä¸­ï¼Œæ‰§è¡Œçš„å…·ä½“å¦‚ä¸‹åˆ†æ</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">  <span class="token string">"__afl_maybe_log:\n"</span>
  <span class="token string">"\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__OpenBSD__<span class="token punctuation">)</span>  <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">defined</span><span class="token punctuation">(</span>__FreeBSD__<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>__FreeBSD__ <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
  <span class="token string">"  .byte 0x9f /* lahf */\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token string">"  lahf\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^__OpenBSD__, etc */</span></span>
  <span class="token string">"  seto  %al\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"  /* Check if SHM region is already mapped. */\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"  movq  __afl_area_ptr(%rip), %rdx\n"</span>
  <span class="token string">"  testq %rdx, %rdx\n"</span>
  <span class="token string">"  je    __afl_setup\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"__afl_store:\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"  /* Calculate and store hit for the code location specified in rcx. */\n"</span>
  <span class="token string">"\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">COVERAGE_ONLY</span></span>
  <span class="token string">"  xorq __afl_prev_loc(%rip), %rcx\n"</span> <span class="token comment">// ä¸¤æ¬¡å¼‚æˆ–æ˜¯å› ä¸ºï¼Œ__afl_prev_locä¿å­˜ä¸Šä¸€ä¸ªbranchçš„ç¼–å·ï¼Œ</span>
  <span class="token string">"  xorq %rcx, __afl_prev_loc(%rip)\n"</span> <span class="token comment">// æ‰§è¡Œåˆ°è¿™é‡Œä¹‹åéœ€è¦æ›´æ–°ä¸ºè¿™ä¸€ä¸ªbranchçš„ç¼–å·</span>
  <span class="token string">"  shrq $1, __afl_prev_loc(%rip)\n"</span> <span class="token comment">// å½“å‰branchçš„ç¼–å·å³ç§»ä¸€ä½ï¼Œç„¶åå­˜å‚¨åœ¨afl_prev_locä¸­ï¼Œå³ç§»æ˜¯ä¸ºäº†å‡å°‘å†²çªï¼Œ</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^!COVERAGE_ONLY */</span></span>
  <span class="token string">"\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">SKIP_COUNTS</span></span>
  <span class="token string">"  orb  $1, (%rdx, %rcx, 1)\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token string">"  incb (%rdx, %rcx, 1)\n"</span> <span class="token comment">// å®ç°äº† share_memory[rcx^afl_prev_loc]++çš„æ“ä½œ</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^SKIP_COUNTS */</span></span>
  <span class="token string">"\n"</span>
  <span class="token string">"__afl_return:\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">"  addb $127, %al\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span><span class="token punctuation">(</span>__OpenBSD__<span class="token punctuation">)</span>  <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">defined</span><span class="token punctuation">(</span>__FreeBSD__<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>__FreeBSD__ <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
  <span class="token string">"  .byte 0x9e /* sahf */\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
  <span class="token string">"  sahf\n"</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">/* ^__OpenBSD__, etc */</span></span>
  <span class="token string">"  ret\n"</span>
  <span class="token string">"\n"</span>
  <span class="token string">".align 8\n"</span>
  <span class="token string">"\n"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<ul>
<li>é€šè¿‡å…¨å±€å˜é‡<code>__afl_area_ptr</code>æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼ˆå…±äº«å†…å­˜æ˜¯å¦è®¾ç½®ï¼‰
<ul>
<li>å¦‚æœæ²¡æœ‰åˆ™je è·³è½¬åˆ°__afl_setupå‡½æ•°</li>
<li>å¦‚æœå·²ç»åˆå§‹åŒ–åˆ™æ‰§è¡Œ__afl_store<br>
ç”±<code>__afl_store</code>å‡½æ•°æ³¨é‡Šå¯çŸ¥ï¼šè¯¥å‡½æ•°è¢«ç”¨æ¥è®¡ç®—å¹¶å­˜å‚¨rcxæŒ‡å®šä»£ç çš„æ‰§è¡Œæ¦‚ç‡ã€‚<br>
æ‰€ä»¥è¿™ä¸€éƒ¨åˆ†ä»£ç åº”è¯¥æ˜¯è®¡ç®—rcxæ ‡è®°çš„ä»£ç å—çš„æ‰§è¡Œæ¬¡æ•°ï¼ŒåæœŸä¼šè¢«ç”¨æ¥è®¡ç®—ä»£ç è¦†ç›–ç‡ã€‚</li>
</ul>
</li>
</ul>
<p><code>__afl_prev_loc</code>å­˜å‚¨å‰ä¸€å—ä»£ç å—çš„RCXç¼–å·ï¼Œå’Œè¿™ä¸€å—å¼‚æˆ–ä¹‹åä¿å­˜åœ¨RCXä¸­ï¼Œç„¶åå†æ¬¡å’ŒRCXå¼‚æˆ–ï¼Œä¿å­˜åœ¨__afl_prev_locä¸­ï¼Œè¿™æ˜¯ä¸ºäº†å°†å½“å‰å—çš„ç¼–å·ä¿å­˜åˆ°å…¨å±€å˜é‡ä¸­ï¼Œå¼‚æˆ–ä¹‹åå¾—åˆ°çš„è·¯å¾„ç†è®ºä¸Šæ¥è¯´æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯å®é™…ä¸Šä¸ä¸€å®šå”¯ä¸€ï¼Œä¸ºäº†é¿å…å†²çªå°†æœ€åå¾—åˆ°çš„å€¼è¿˜å³ç§»äº†ä¸€ä½ï¼Œæœ€åä¸€ä¸ªincbæŒ‡ä»¤å®ç°äº†<code>hare_memory[rcx^afl_prev_loc]++çš„æ“ä½œ</code>ï¼Œå°†å…±äº«å†…å­˜å¯¹åº”ä½ç½®çš„countåŠ ä¸€ã€‚</p>
<p><code>addb $127, %al</code>æ¢å¤æº¢å‡ºå¯„å­˜å™¨æ ‡è¯†ä½ï¼ˆå‰é¢å¦‚æœè¢«ç½®ä½çš„è¯ï¼Œè¿™é‡ŒåŠ <code>127</code>ä¼šæº¢å‡ºï¼Œå®ç°ç½®ä½ï¼‰ï¼Œ<code>sahf</code>æŒ‡ä»¤æ¢å¤å…¶ä½™çš„æ ‡å¿—ä½å¯„å­˜å™¨ï¼Œæ¢å¤ç°åœºï¼Œ<code>__afl_maybe_log</code>ç»“æŸï¼Œåˆ†æ”¯è®°å½•å®Œæˆï¼Œè¿”å›åˆ°æ­£å¸¸çš„ç¨‹åºæ‰§è¡Œã€‚</p>
<p><code>__afl_setup</code>å‡½æ•°è´Ÿè´£åˆå§‹åŒ–ï¼Œåˆå§‹åŒ–çš„æµç¨‹ä¹Ÿç›¸å¯¹ç®€å•ï¼Œåªæ˜¯ä»£ç æ¯”è¾ƒé•¿ã€‚<br>
æ±‡ç¼–ä»£ç çš„è®¾è®¡æ²¡å•¥å¥½åˆ†æçš„ï¼Œæ€»ç»“äº†ä¸€ä¸‹å¤§æ¦‚å°±æ˜¯ä»¥ä¸‹ä¼ªä»£ç ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c">__afl_setup<span class="token operator">:</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>__afl_setup_failure<span class="token punctuation">)</span> <span class="token keyword">return</span> __afl_return
	<span class="token keyword">if</span><span class="token punctuation">(</span>__afl_global_area_ptr<span class="token punctuation">)</span> <span class="token keyword">return</span> __afl_store
	<span class="token keyword">else</span> __afl_setup_first

__afl_setup_first
	save all the <span class="token function">regs</span><span class="token punctuation">(</span>include xmm0<span class="token punctuation">)</span>
	AFL_SHM_ENV <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span>AFL_SHM_ENV<span class="token punctuation">)</span>
	a <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>AFL_SHM_ENV<span class="token punctuation">)</span>
	addr <span class="token operator">=</span> <span class="token function">shmat</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
	__afl_arena_ptr <span class="token operator">=</span> addr
	__afl_global_area_ptr@GOTPCREL <span class="token operator">=</span> addr
	__afl_forkserver<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>éœ€è¦æ³¨æ„çš„åœ°æ–¹åªæœ‰åç»­çš„forkserverå‡½æ•°å’Œshmatå‡½æ•°ï¼Œshmatå‡½æ•°æ˜¯ç”¨æ¥å…è®¸æœ¬è¿›ç¨‹è®¿é—®ä¸€å—å…±äº«å†…å­˜çš„å‡½æ•°ï¼Œä¸€èˆ¬å’Œshmgetå‡½æ•°ä¸€èµ·ä½¿ç”¨ã€‚</p>
<blockquote>
<p>void *shmatï¼ˆint shmidï¼Œconst void *shmaddr,int shmflgï¼‰;<br>
å®ƒéœ€è¦å¦‚ä¸‹3ä¸ªå‚æ•°ï¼š<br>
ç¬¬ä¸€ä¸ªæ˜¯å‚æ•°æ˜¯ shmid æ˜¯shmget è¿”å›çš„æ ‡è¯†ç¬¦ï¼Œ<br>
ç¬¬äºŒä¸ªå‚æ•° ä¸‰ç§æƒ…å†µ<br>
1.å¦‚æœshmaddr æ˜¯NULLï¼Œç³»ç»Ÿå°†è‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„åœ°å€ï¼<br>
2.å¦‚æœshmaddr ä¸æ˜¯NULL å¹¶ä¸”æ²¡æœ‰æŒ‡å®šSHM_RNDï¼Œåˆ™æ­¤æ®µè¿æ¥åˆ°addræ‰€æŒ‡å®šçš„åœ°å€ä¸Š.<br>
3.å¦‚æœshmaddré0 å¹¶ä¸”æŒ‡å®šäº†SHM_RND åˆ™æ­¤æ®µè¿æ¥åˆ°shmaddr -ï¼ˆshmaddr mod SHMLAB)æ‰€è¡¨ç¤ºçš„åœ°å€ä¸Šã€‚è¿™é‡Œè§£é‡Šä¸€ä¸‹SHM_RNDå‘½ä»¤ï¼Œå®ƒçš„æ„æ€æ˜¯å–æ•´ï¼Œè€ŒSHMLABçš„æ„æ€æ˜¯ä½è¾¹ç•Œåœ°å€çš„å€æ•°ï¼Œå®ƒæ€»æ˜¯2çš„ä¹˜æ–¹ï¼Œè¯¥ç®—å¼æ˜¯å°†åœ°å€å‘ä¸‹å–æœ€è¿‘ä¸€ä¸ªSHMLABçš„å€æ•°ã€‚ é™¤éåªè®¡åˆ’åœ¨ä¸€ç§ç¡¬ä»¶ä¸Šè¿è¡Œåº”ç”¨ç¨‹åº(åœ¨ç°åœ¨æ˜¯ä¸å¤ªå¯èƒ½çš„)ï¼Œå¦åˆ™ä¸ç”¨æŒ‡å®šå…±äº«æ®µæ‰€è¿æ¥åˆ°çš„åœ°å€ã€‚æ‰€ä»¥ä¸€èˆ¬æŒ‡å®šshmaddrä¸º0ï¼Œä»¥ä¾¿ç”±å†…æ ¸é€‰æ‹©åœ°å€ã€‚<br>
ç¬¬ä¸‰ä¸ªå‚æ•°å¦‚æœåœ¨flagä¸­æŒ‡å®šäº†SHM_RDONLYä½ï¼Œåˆ™ä»¥åªè¯»æ–¹å¼è¿æ¥æ­¤æ®µï¼Œå¦åˆ™ä»¥è¯»å†™çš„æ–¹å¼è¿æ¥æ­¤æ®µã€‚<br>
shmatè¿”å›å€¼æ˜¯è¯¥æ®µæ‰€è¿æ¥çš„å®é™…åœ°å€ï¼Œå¦‚æœå‡ºé”™è¿”å› -1.</p>
</blockquote>
<p>å‡½æ•°è°ƒç”¨ä¸­ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šäº†ï¼Œå‰©ä¸‹ä¸¤ä¸ªå‚æ•°éƒ½æ˜¯0ï¼Œåˆ™è¿™é‡Œæ˜¯ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ä¸€å—åˆé€‚çš„å…±äº«å†…å­˜åœ°å€ã€‚</p>
<p>ä¸ºäº†å¼„æ¸…æ¥šè¿™ä¸ªå…±äº«å†…å­˜æ˜¯åœ¨å“ªé‡Œåˆå§‹åŒ–çš„ï¼Œè¿½æº¯ç¯å¢ƒå˜é‡<code>AFL_SHM_ENV</code>ï¼Œå‘ç°è¯¥å˜é‡å®é™…ä¸Šæ¥è‡ª<code>SHM_ENV_VAR</code>ï¼Œè¿™ä¸€ç¯å¢ƒå˜é‡çš„äº§ç”Ÿåœ¨afl-fuzz.cä¸­çš„<code>setup_shm</code>å‡½æ•°ã€‚</p>
<p>ç”±shmgeté€šè¿‡å…¶æœºåˆ¶è¿”å›äº†ä¸€å—å…±äº«å†…å­˜çš„idï¼Œè€Œshmatçš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¿™ä¸ªidã€‚<br>
å¯ä»¥çœ‹åˆ°åˆå§‹åŒ–å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ†é…ä¸€å—å…±äº«ç©ºé—´å³å¯ã€‚</p>
<p>åé¢çš„afl_forkserverä¸»è¦å‡½æ•°å¦‚ä¸‹ï¼š</p>
<ul>
<li>é¦–å…ˆé€šè¿‡writeå‘é€4å­—èŠ‚æ•°æ®ç»™fuzzerï¼Œå‘Šè¯‰fuzzeræˆ‘å‡†å¤‡å¥½äº†</li>
<li>ç„¶åè¿›å…¥loopå¾ªç¯ï¼Œå¾ªç¯ä¼šé˜»å¡åœ¨readå‡½æ•°ï¼Œæ¥å—fuzzerçš„4å­—èŠ‚ä¿¡å·</li>
<li>forkå‡½æ•°forkå‡ºæ¥ä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åçˆ¶è¿›ç¨‹å‘é€å­è¿›ç¨‹çš„è¿›ç¨‹å·ç»™fuzzerï¼Œç„¶åç­‰å­è¿›ç¨‹ç»“æŸ</li>
<li>å­è¿›ç¨‹<code>In child process: close fds, resume execution</code>ï¼Œç„¶åè¿”å›ä¹‹å‰ä¿å­˜çš„å¯„å­˜å™¨ï¼ˆä¸Šä¸‹æ–‡ï¼‰ï¼Œä¹‹åè·³åˆ°afl_storeè®°å½•è¦†ç›–ç‡ç„¶åç»§ç»­æ‰§è¡Œä»£ç ï¼Œè¿™é‡Œä½“ç°çš„å°±æ˜¯forkserverçš„ç²¾é«“ï¼Œfuzzeråªè¦è®°å½•å­è¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œç„¶åæ¯æ¬¡æ’æ¡©çš„æ—¶å€™å¯ä»¥å‡ºä¸€ä¸ªæ–°çš„è¿›ç¨‹æ‰§è¡Œï¼Œè€Œä¸ç”¨é‡æ–°execveä¸€éã€‚</li>
</ul>
<h4 id="fuzzer-ç›¸å…³"><a class="header-anchor" href="#fuzzer-ç›¸å…³">Â¶</a>fuzzer ç›¸å…³</h4>
<p>fuzzeré‚£è¾¹çš„forkserveråˆå§‹åŒ–åœ¨<code>afl-fuzz.cä¸­çš„init_forkserver</code>å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ç”±<code>calibrate_case</code>å‡½æ•°è°ƒç”¨ï¼Œå½“<code>forksrv_pid</code>æ²¡æœ‰å€¼çš„æ—¶å€™ï¼Œè¯´æ˜<code>forkserver</code>å°šæœªåˆå§‹åŒ–ï¼Œè°ƒç”¨<code>init_forkserver</code>ã€‚</p>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>dumb_mode <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>no_forkserver <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>forksrv_pid<span class="token punctuation">)</span>
  <span class="token function">init_forkserver</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div></figure>
<p>init_forkserverå‡½æ•°æ‰§è¡Œæ“ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>pipeåˆ›å»ºäº†ä¸¤ä¸ªç®¡é“<code>ctl_pipeå’Œst_pipe</code>ï¼Œä¸”é€šè¿‡forkï¼Œåˆ›å»ºäº†ä¸€ä¸ªå­è¿›ç¨‹</li>
<li>å­è¿›ç¨‹é€šè¿‡setrlimitå‡½æ•°ï¼Œè®¾ç½®äº†å­è¿›ç¨‹çš„ä¸€äº›èµ„æºï¼Œå¹¶ä¸”å°†å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ï¼Œè¾“å‡ºï¼Œé”™è¯¯æµå…¨éƒ¨å…³é—­ï¼Œè¾“å…¥æ”¹ä¸ºäº†æ–‡ä»¶è¾“å…¥ã€‚</li>
<li>åŒæ—¶<code>setsid</code>è§£æ”¾å­è¿›ç¨‹ï¼Œè®©å…¶æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä¸å—çˆ¶è¿›ç¨‹å½±å“ï¼Œæ¥ç€å­è¿›ç¨‹ä½¿ç”¨cttl_pipeçš„è¾“å‡ºç«¯å’Œst_pipeçš„è¾“å…¥ç«¯ï¼Œç„¶åè°ƒç”¨execveæ‰§è¡Œç›®æ ‡ç¨‹åº</li>
<li>çˆ¶è¿›ç¨‹ä½¿ç”¨ctl_pipeçš„è¾“å…¥ç«¯å’Œst_pipeçš„è¾“å‡ºç«¯ï¼Œé€šè¿‡readå‡½æ•°è¯»å–st_pipeç®¡é“çš„æ•°æ®ï¼Œç›´åˆ°æ¥å—4ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œè¿”å›forkserveråˆ›å»ºæˆåŠŸï¼Œç„¶åé€€å‡ºå‡½æ•°ã€‚<br>
åœ¨å­è¿›ç¨‹æ‰§è¡Œçš„æ—¶å€™è°ƒç”¨äº†<code>execve</code>ï¼Œå› ä¸ºè¯¥å‡½æ•°ä¸ä¼šè¿”å›ï¼Œåé¢åŠ ä¸Š<code>*(u32*)trace_bits = EXEC_FAIL_SIG;</code>è¯­å¥ï¼Œå°±çŸ¥é“å¦‚æœæ‰§è¡Œäº†è¯¥è¯­å¥ï¼Œé‚£ä¹ˆexecveæ‰§è¡Œå°±å¤±è´¥äº†ï¼Œå°±æ„å‘³ç€forkserveråˆ›å»ºå¤±è´¥ã€‚</li>
</ul>
<p>ç»¼ä¸Šåˆ†æï¼Œafl-fuzzæ‰§è¡Œåˆ°init_forkserverå‡½æ•°çš„æ—¶å€™ï¼Œåˆ›å»ºäº†fuzzerï¼ˆè‡ªå·±ï¼‰å’Œforkserverï¼ˆå­è¿›ç¨‹ï¼‰ï¼Œforkserverä¼šç»§ç»­æ‰§è¡Œç›®æ ‡ç¨‹åºï¼Œç„¶ååœ¨ç¬¬ä¸€ä¸ªæ’æ¡©çš„ä½ç½®ï¼Œè¿›å…¥<code>__afl_forkserver</code>ï¼Œåˆå§‹åŒ–forkserverï¼Œç„¶åè¿”å›ä¿¡æ¯ç»™çˆ¶è¿›ç¨‹ï¼Œæ­¤æ—¶fuzzeræ¥æ”¶åˆ°åˆ›å»ºæˆåŠŸçš„æ¶ˆæ¯ï¼Œinit_forkserverè§¦å‘returnï¼Œç»§ç»­æ‰§è¡Œåˆ«çš„ä»£ç ï¼Œè€Œforkserverå†æ¬¡è°ƒç”¨forkï¼Œæ‰§è¡Œç›®æ ‡è¿›ç¨‹ã€‚</p>
<p>åœ¨åç»­çš„<code>æ¡©</code>ä¸­ï¼Œå› ä¸ºå·²ç»åˆå§‹åŒ–ï¼Œæ‰€ä»¥åªéœ€è¦å¾€å…±äº«å†…å­˜ä¸­è®°å½•ä»£ç è¦†ç›–ç‡å³å¯ã€‚</p>
<p>æœ€ç»ˆå½¢æˆçš„forkserverå¦‚ä¸‹ï¼š<br>
<img src="https://fortypra.oss-cn-hangzhou.aliyuncs.com/img/20221215151315.png" srcset="/img/loading.gif" lazyload alt=""></p>
<h3 id="whileå¾ªç¯å†…çš„å¤„ç†"><a class="header-anchor" href="#whileå¾ªç¯å†…çš„å¤„ç†">Â¶</a>whileå¾ªç¯å†…çš„å¤„ç†</h3>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pass_thru <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>skip_intel <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>skip_app <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>skip_csect <span class="token operator">&amp;&amp;</span> instr_ok <span class="token operator">&amp;&amp;</span> instrument_next <span class="token operator">&amp;&amp;</span> line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\t'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isalpha</span><span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token function">fprintf</span><span class="token punctuation">(</span>outf<span class="token punctuation">,</span> use_64bit <span class="token operator">?</span> trampoline_fmt_64 <span class="token operator">:</span> trampoline_fmt_32<span class="token punctuation">,</span> <span class="token function">R</span><span class="token punctuation">(</span>MAP_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	instrument_next <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    ins_lines<span class="token operator">++</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>whileä¸­çš„ç¬¬ä¸€ä¸ªifæ¡ä»¶ï¼Œæ»¡è¶³è¯¥æ¡ä»¶åˆ™è¿›è¡Œæ’æ¡©ï¼Œæ’æ¡©çš„å…·ä½“æ“ä½œæ˜¯fprintfæŠŠtrampolineä»£ç è¯»å…¥ outfï¼Œç„¶åins_lineæ’æ¡©è®¡æ•°å™¨åŠ ä¸€ï¼Œtrampolineå°±æ˜¯æ’æ¡©æ’å…¥çš„è¯­å¥ï¼Œæ¶‰åŠåˆ°forkserveræœºåˆ¶ï¼Œåé¢å†åˆ†æã€‚</p>
<p>pass_thruæ ‡å¿—å®åœ¨edit_paramä¸­è®¾ç½®çš„ï¼Œå…·ä½“ä½œç”¨ä¸çŸ¥ï¼Œè®¾ç½®çš„æ¡ä»¶æ˜¯<code>tmp_dirä¸º/tmp</code>ã€‚</p>
<ul>
<li>å®é™…ä¸Šåªéœ€è¦æ³¨æ„åˆ°instr_okæ ‡å¿—ä½å³å¯ï¼Œè¯¥æ ‡å¿—ä½ç”¨æ¥è¡¨ç¤ºå½“å‰sectionæ˜¯å¦ä¸ºtextæ®µï¼Œå› ä¸ºAFLåªéœ€è¦åœ¨textæ®µæ’æ¡©ï¼Œinstr_okä¸º1åˆ™è¡¨ç¤ºä¸ºtextæ®µï¼Œbssç­‰å…¶ä»–æ®µåˆ™ç”¨instr_ok=0è¡¨ç¤º
<ul>
<li><code>\t.text</code>è¡¨ç¤ºä»£ç æ®µï¼Œç±»ä¼¼çš„ï¼Œå¯ä»¥è¡¨ç¤ºåˆ«çš„æ®µ</li>
<li>é€šè¿‡æ£€æŸ¥lineä¸­çš„å†…å®¹å¯ä»¥å¾—åˆ°ä»¥ä¸‹å¤„ç†è¿‡ç¨‹
<ul>
<li>å¦‚æœä¸æ˜¯clangmode ä¸” instr_ok=1 ä¸”lineä¸º<code>\t.p2align!\n</code> å…¶ä¸­æ„Ÿå¹å·ç”¨æ¥ä»£æŒ‡æ•°å­—ï¼Œé‚£ä¹ˆè®¾ç½®skip_next_labelä¸º1ï¼Œè¯¥æ ‡ç­¾è¢«ç”¨æ¥å¤„ç†<code>OpenBSD</code>ç³»ç»Ÿä¸Šçš„è·³è½¬è¡¨è€Œè®¾ç½®çš„æ ‡å¿—ä½</li>
<li>å¦‚æœ<code>\t.text | section\t.text | section\t__TEXT,__text</code>æ˜¯è¿™ä¸€è¡Œçš„å¼€å¤´ï¼Œé‚£ä¹ˆè®¾ç½®instr_okä¸º1ï¼Œå³æ ‡è®°ä¸ºä»£ç æ®µ</li>
<li>å¦‚æœ<code>\t.section\t | \t.section | \t.bss | \t.data</code>å¼€å¤´åˆ™æ ‡è®°instr_okä¸º0</li>
</ul>
</li>
<li>å®Œæˆä»¥ä¸Šçš„åˆ¤æ–­ï¼Œåˆ™è¿”å›åˆ°getlineè¯»å–ä¸‹ä¸€è¡Œ</li>
</ul>
</li>
<li>è®¾ç½®å®Œæ¯•æ ‡å¿—ä½ä¹‹åï¼Œåé¢å¯ä»¥çœ‹åˆ°åœ¨ä»£ç æ®µä¸­çš„ä»€ä¹ˆä½ç½®æ’æ¡©ï¼Œå‰é¢æœ‰æ³¨é‡Šæåˆ°äº†ï¼Œä½†æ˜¯é™¤äº†ç¬¬ä¸€æ®µifåˆ¤æ–­æ’æ¡©ä¹‹å¤–ï¼Œåé¢è¿˜æœ‰ä¸€å¤„åˆ¤æ–­æ’æ¡©ã€‚</li>
</ul>
<figure><div class="code-wrapper"><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\t'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>line<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'j'</span> <span class="token operator">&amp;&amp;</span> line<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">'m'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">R</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> inst_ratio<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span>outf<span class="token punctuation">,</span> use_64bit <span class="token operator">?</span> trampoline_fmt_64 <span class="token operator">:</span> trampoline_fmt_32<span class="token punctuation">,</span> <span class="token function">R</span><span class="token punctuation">(</span>MAP_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ins_lines<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div></figure>
<p>é‡ä¸Šè·³è½¬è¯­å¥ä¸”ä¸æ˜¯æ— æ¡ä»¶è·³è½¬ï¼Œåˆ™è¿›è¡Œæ’æ¡©ï¼ŒåŒæ—¶<code>instrument_next</code>è¡¨ç¤ºä¸‹ä¸€æ¡è¯­å¥éœ€è¦æ’æ¡©ã€‚</p>
<ul>
<li>main_payloadæ·»åŠ åˆ°æœ«å°¾<br>
<code>fputs(use_64bit ? main_payload_64 : main_payload_32, outf);</code></li>
<li>æœ€åå…³é—­ç›¸åº”çš„å¥æŸ„ï¼Œç»“æŸæ’æ¡©</li>
</ul>
<p>æ€»ç»“èµ·æ¥ï¼Œä¼¼ä¹åªæœ‰instr_okæ¯”è¾ƒæœ‰ç”¨ï¼Œä¸»è¦æ˜¯åœ¨è·³è½¬æŒ‡ä»¤çš„åé¢æ’æ¡©ã€‚<br>
å…·ä½“çš„å¯ä»¥çœ‹sakuraå¸ˆå‚…å¯¹è¯¥éƒ¨åˆ†çš„æ€»ç»“ï¼Œå…¶ä¸­è¿˜æœ‰äº›åœ°æ–¹æˆ‘çš„ç†è§£ä¸å¤Ÿæ·±å…¥ã€‚<br>
<a target="_blank" rel="noopener" href="https://eternalsakura13.com/2020/08/23/afl/#more">https://eternalsakura13.com/2020/08/23/afl/#more</a></p>
<p>è¯¥å‡½æ•°æ’æ¡©ä¼¼ä¹åªæ˜¯åœ¨modified_fileæ–‡ä»¶æ’å…¥äº†ä¸€äº›ä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰å’ŒåŸæœ¬çš„æ±‡ç¼–è”ç³»èµ·æ¥ï¼ˆå°½ç®¡æ˜¯æŒ‰ç…§åŸæ¥çš„æ±‡ç¼–åšçš„æ’æ¡©ï¼Œä½†æ˜¯æ²¡æœ‰æ’åœ¨åŸæ¥çš„æ±‡ç¼–ä¸­ï¼‰</p>
<p>é€šè¿‡åç¼–è¯‘æŸ¥çœ‹æ’æ¡©æ•ˆæœæ¥çœ‹ï¼Œç¡®å®åœ¨æ¯ä¸€ä¸ªæ ‡ç­¾çš„ä½ç½®ï¼Œä¹‹å‰éƒ½æ’å…¥äº†æŒ‡å®šçš„æ±‡ç¼–ä»£ç ã€‚ç„¶åæ±‡è¿‡å»å†çœ‹ä»£ç ï¼Œçœ‹åˆ°äº†æœŸæœ›çš„ä»£ç ï¼š<br>
<code>fputs(line, outf);</code>ï¼Œæ¯æ¬¡æ’æ¡©åéƒ½æœ‰è¯¥è¯­å¥ï¼ˆé™¤äº†è·³è½¬æ’æ¡©ï¼‰ï¼Œè¯¥è¯­å¥æŠŠæ­£å¸¸çš„æ±‡ç¼–å’Œæ’æ¡©ä»£ç ä¸€èµ·å†™å…¥äº†æ–°æ–‡ä»¶ã€‚</p>
<h2 id="main"><a class="header-anchor" href="#main">Â¶</a>main</h2>
<ul>
<li>ä»<code>AFL_INST_RATIO</code>ç¯å¢ƒå˜é‡ä¸­è·å¾—inst_ratio_strçš„å€¼</li>
<li>è®¾ç½®srandomçš„éšæœºç§å­ä¸º<code>rand_seed = tv.tv_sec ^ tv.tv_usec ^ getpid();</code></li>
<li>è®¾ç½®AS_LOOP_ENV_VARä¸º1</li>
<li>edit_paramså‡½æ•°</li>
<li>åˆ¤æ–­ç¯å¢ƒå˜é‡AFL_USE_ASANå’ŒAFL_USE_MASNæ˜¯å¦ä¸ºç©ºï¼Œåªè¦å…¶ä¸­ä¸€ç§ä¸ä¸ºç©ºï¼Œåˆ™è®¾ç½®sanitizerä¸º1ï¼Œä¸”å°†inst_ratioé™¤ä»¥ï¼Œå› ä¸ºå¸¦ASANç¼–è¯‘çš„è¯ï¼Œæ²¡æœ‰åŠæ³•è¯†åˆ«å‡ºæ¥ä¸€äº›ç‰¹åˆ«çš„ASANåˆ†æ”¯ï¼Œæ‰€ä»¥åœ¨æ’æ¡©ä¸Šä¼šå¤šå¾ˆå¤šå¼€é”€ï¼Œåˆ™æš´åŠ›å°†æ’æ¡©æ¦‚ç‡é™¤ä»¥3</li>
<li>å­è¿›ç¨‹æ‰§è¡Œ <code>execvp(as_params[0], (char**)as_params);</code></li>
<li>unlink(modified_file)</li>
</ul>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/CVE/" class="category-chain-item">CVE</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/AFL/">#AFL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>AFL(äºŒ)---ç¼–è¯‘å’Œæ’æ¡©åˆ†æ</div>
      <div>http://example.com/2022/12/15/AFL-äºŒ-ç¼–è¯‘å’Œæ’æ¡©åˆ†æ/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>Epiphany</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2022å¹´12æœˆ15æ—¥</div>
        </div>
      
      
      <div class="license-meta-item">
        <div>è®¸å¯åè®®</div>
        <div>
          
            
            
              <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
              <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                <i class="iconfont icon-by"></i>
              </span>
              </a>
            
          
        </div>
      </div>
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/12/15/AFL-%E4%B8%80-%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" title="AFL(ä¸€)---åŸºç¡€çŸ¥è¯†">
                        <span class="hidden-mobile">AFL(ä¸€)---åŸºç¡€çŸ¥è¯†</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.4.17/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"QC4vvYPEM2BYGMlNkxfbdllW-gzGzoHsz","appKey":"nsnNub648pvsc3yts6pFQY1A","path":"window.location.pathname","placeholder":"ç•™è¨€å­","avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"https://qc4vvype.lc-cn-n1-shared.com","emojiCDN":null,"emojiMaps":null,"enableQQ":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="website-duration">è½½å…¥ç½‘ç«™è¿è¡Œæ—¶é—´...</span> <script src="/js/duration.js"></script> </div>   
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        æ€»è®¿é—®é‡ 
        <span id="leancloud-site-pv"></span>
         æ¬¡
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        æ€»è®¿å®¢æ•° 
        <span id="leancloud-site-uv"></span>
         äºº
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      headingSelector : CONFIG.toc.headingSelector || 'h1,h2,h3,h4,h5,h6',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      collapseDepth   : CONFIG.toc.collapseDepth || 0,
      scrollSmooth    : true,
      headingsOffset  : -boardTop
    });
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }
  });
</script>


  <script  src="https://lib.baomitu.com/prism/1.27.0/plugins/line-numbers/prism-line-numbers.min.js" ></script>

  <script src=https://lib.baomitu.com/clipboard.js/2.0.10/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script defer src="/js/leancloud.js" ></script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
